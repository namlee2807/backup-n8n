{
  "active": false,
  "connections": {
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Split Out3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out3": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Search URL Image Google": {
      "main": [
        [
          {
            "node": "Image Scource",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Image": {
      "main": [
        [
          {
            "node": "Resize Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resize Image": {
      "main": [
        [
          {
            "node": "Google Drive2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Upload chapter images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Scource": {
      "main": [
        [
          {
            "node": "Limit2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload chapter images": {
      "main": [
        [
          {
            "node": "Update image meta data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update image meta data": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search URL Image Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Split Out4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out4": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenAI2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Limit2": {
      "main": [
        []
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Limit3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit3": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-03-16T03:00:31.413Z",
  "id": "j1d6CNt2kg3YH2f4",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Read Data Image",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -560,
        1400
      ],
      "id": "d88bb155-d126-4d5d-b147-89d768e1c112",
      "name": "When clicking ‘Test workflow’"
    },
    {
      "parameters": {
        "url": "=https://serpapi.com/search.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "serpApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={\n  \"q\": \"{{ $json.keyword }}\",\n  \"tbm\": \"isch\",\n  \"hl\": \"vi\",\n  \"gl\": \"vn\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -260,
        -140
      ],
      "id": "58124074-4936-4824-9eec-2f855fcb41b2",
      "name": "HTTP Request",
      "credentials": {
        "serpApi": {
          "id": "s7AgvtfJYXwuEi5E",
          "name": "SerpAPI (thipha0409)"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59327f63-8b04-4b0a-83f7-cad4f64da490",
              "name": "keyword",
              "value": "honda civic",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -500,
        -140
      ],
      "id": "b515dfed-0dd1-41ab-aa31-da2006403477",
      "name": "Edit Fields",
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "images_results",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -40,
        -140
      ],
      "id": "a13e1bdb-e58e-4cac-b615-a6965bc1b38e",
      "name": "Split Out",
      "disabled": true
    },
    {
      "parameters": {
        "maxItems": 100
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        180,
        -140
      ],
      "id": "6106a647-8a96-4a9b-9dc7-ca0ff4ecb287",
      "name": "Limit",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        840,
        -140
      ],
      "id": "2726bd32-62fb-4310-9028-664464c8b053",
      "name": "Loop Over Items",
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "original"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        400,
        -140
      ],
      "id": "3e4e83b5-f661-446b-8d3f-81fc07cb2f8e",
      "name": "Aggregate",
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "original",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        620,
        -140
      ],
      "id": "ac347946-62a9-40f5-8a8e-39e02a42bf8b",
      "name": "Split Out1",
      "disabled": true
    },
    {
      "parameters": {
        "name": "={{ $('Loop Over Items').item.json.original }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1rT_TyQaF_T4X73poAl_m8jn2_-HtKLAO",
          "mode": "list",
          "cachedResultName": "Honda city",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1rT_TyQaF_T4X73poAl_m8jn2_-HtKLAO"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -100,
        520
      ],
      "id": "45263c30-099d-4b5a-a9eb-d74f96b9cbd4",
      "name": "Google Drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "MoQgn4R3hctsZUEQ",
          "name": "Google Drive API (namlee2807)"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "04ef6b18-a907-4c38-8086-766a759bcea3",
              "leftValue": "={{ $json.responses[0].logoAnnotations.length}}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        100,
        280
      ],
      "id": "fdef813d-4c33-4656-a057-aea740241424",
      "name": "If",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -320,
        280
      ],
      "id": "090b30f4-2ba6-4efb-8e3b-f8a904865774",
      "name": "Extract from File",
      "disabled": true
    },
    {
      "parameters": {
        "url": "={{ $json.original }}",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Accept\": \"image/webp,image/apng,image/*,*/*;q=0.8\"\n}\n",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -560,
        280
      ],
      "id": "aff3bcf3-be30-43c4-ae46-10ecde1c627e",
      "name": "HTTP Request2",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://vision.googleapis.com/v1/images:annotate",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n    {\n      \"image\": {\n        \"content\": \"{{ $json.data }}\"\n      },\n      \"features\": [\n        {\n          \"type\": \"LOGO_DETECTION\",\n          \"maxResults\": 5\n        }\n      ]\n    }\n  ]\n}\n",
        "options": {
          "allowUnauthorizedCerts": false,
          "lowercaseHeaders": true,
          "pagination": {}
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -100,
        280
      ],
      "id": "1e26d71f-1d6f-499e-8c76-c5518a161c3f",
      "name": "HTTP Request1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "wPYfO85eywm4HX0E",
          "name": "Perplexity AI Authorization"
        },
        "oAuth2Api": {
          "id": "1bTPLuaSXS5Kdjx5",
          "name": "Google Vision API"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "imageUrls": "={{ $json.original }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1080,
        0
      ],
      "id": "fe2dc7f2-a34f-4af0-899f-52f8239be8ee",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "7SlLLSEUnoJ4ouGB",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3b788b4f-075c-4b3b-bdb6-d65848689dda",
              "name": "Keyword",
              "value": "thông số kỹ thuật Honda City",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -400,
        820
      ],
      "id": "8282aa13-b86f-40b9-8987-b929ffce4d55",
      "name": "Edit Fields1",
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://serpapi.com/search.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "serpApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={\n  \"q\": \"{{ $json.Keyword }}\",\n  \"tbm\": \"isch\",\n  \"hl\": \"vi\",\n  \"gl\": \"vn\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -160,
        820
      ],
      "id": "00384b63-1265-482b-bb9e-e826bbeaca10",
      "name": "HTTP Request3",
      "credentials": {
        "serpApi": {
          "id": "s7AgvtfJYXwuEi5E",
          "name": "SerpAPI (thipha0409)"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "=Please analyze the image and tell me:\n\n1. Does this image contain any brand logos or business information?\n2. Is there any visible text on the image?\n3. Should we keep this image for professional blog content, or remove it?\n\nOutput JSON:\n{\n  \"has_logo\": true/false,\n  \"detected_text\": \"...\",\n  \"recommendation\": \"keep/remove\"\n}\n",
        "imageUrls": "={{ $json.original }}",
        "options": {
          "detail": "low"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1260,
        940
      ],
      "id": "a79dab69-8554-421e-ba44-5169030377a9",
      "name": "OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "7SlLLSEUnoJ4ouGB",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "images_results",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        60,
        820
      ],
      "id": "2750127c-24b8-40cd-b916-6d25831cff55",
      "name": "Split Out2",
      "disabled": true
    },
    {
      "parameters": {
        "maxItems": 20
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        280,
        820
      ],
      "id": "e787be1d-36b1-4f63-97a1-2daf7a7c63ec",
      "name": "Limit1",
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "original"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        500,
        820
      ],
      "id": "576c0d21-8a96-4eb0-8482-c76d91305b60",
      "name": "Aggregate1",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1000,
        820
      ],
      "id": "ebdc48cc-d44a-49ef-b151-d4d5180b7996",
      "name": "Loop Over Items1",
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "original",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        780,
        820
      ],
      "id": "2cbed438-b78c-4c47-b582-a966658d0da0",
      "name": "Split Out3",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e74344da-d29a-44e6-bf22-106eebc23d45",
              "leftValue": "={{ $json.has_logo }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1640,
        940
      ],
      "id": "b4205582-31f3-4ac0-84a4-28bea64cd99f",
      "name": "If1",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const parsed = JSON.parse($json.content);\n\nreturn [\n  {\n    json: {\n      image_url: $json.original,  // giữ lại URL ảnh để mapping\n      has_logo: parsed.has_logo,\n      detected_text: parsed.detected_text,\n      recommendation: parsed.recommendation\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1460,
        940
      ],
      "id": "06f83ed5-d9f1-4f86-9f19-105dab490bf5",
      "name": "Code",
      "disabled": true
    },
    {
      "parameters": {
        "name": "={{ $('Tách output').item.json.file_name }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Create Folder').item.json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3100,
        1780
      ],
      "id": "64a4e2c9-5b89-455d-b785-86690fd07d32",
      "name": "Google Drive2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "MoQgn4R3hctsZUEQ",
          "name": "Google Drive API (namlee2807)"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://serpapi.com/search.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "serpApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={\n  \"engine\": \"google_images\",\n  \"q\": \"{{ $json.Keyword }}\",\n  \"location_requested\": \"Vietnam\",\n  \"location_used\": \"Vietnam\",\n  \"google_domain\": \"google.com\",\n  \"tbm\": \"isch\",\n  \"hl\": \"vi\",\n  \"gl\": \"vn\",\n  \"imgsz\": \"m\",\n  \"image_type\": \"photo\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        160,
        1680
      ],
      "id": "03c2e9ba-4307-4b87-9170-9031682b88dd",
      "name": "Search URL Image Google",
      "credentials": {
        "serpApi": {
          "id": "s7AgvtfJYXwuEi5E",
          "name": "SerpAPI (thipha0409)"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.original }}",
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "file"
            }
          },
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2460,
        1680
      ],
      "id": "dff3eb8a-55be-4081-80a8-c8e06c6428b3",
      "name": "Download Image"
    },
    {
      "parameters": {
        "operation": "resize",
        "width": 800,
        "height": 0,
        "options": {
          "fileName": "={{ $('Loop Over Items2').item.json.file_name }}",
          "format": "webp"
        }
      },
      "type": "n8n-nodes-base.editImage",
      "typeVersion": 1,
      "position": [
        2700,
        1680
      ],
      "id": "16f59c30-f23a-487b-b5e5-fa4ea877b471",
      "name": "Resize Image"
    },
    {
      "parameters": {
        "fieldToSplitOut": "images_results",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        380,
        1680
      ],
      "id": "f8bc0d89-6ffc-4e4d-9dfc-f9b79d264c67",
      "name": "Image Scource"
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        3560,
        1680
      ],
      "id": "469dbef0-c8c0-4455-920d-35619127ea15",
      "name": "Merge"
    },
    {
      "parameters": {
        "amount": 7
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3780,
        1860
      ],
      "id": "af5b57a6-5c26-46c2-b70d-5ab67dfbf96d",
      "name": "Wait1",
      "webhookId": "ad381969-167c-48aa-9ea9-50e7a615b669"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Google Sheets Trigger1').item.json.Website }}/wp-json/wp/v2/media",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Disposition",
              "value": "=attachment; filename=\"{{ $binary.data.fileName }}.{{ $binary.data.fileExtension }}\""
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3000,
        1600
      ],
      "id": "f8f819ad-54d2-41c9-b0ef-4999adbac599",
      "name": "Upload chapter images",
      "credentials": {
        "wordpressApi": {
          "id": "QgbogXv2coNRFVF3",
          "name": "hondaotosaigonquan2.com.vn"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('Limit2').item.json.Website }}/wp-json/wp/v2/media/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "wordpressApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "alt_text",
              "value": "={{ $('Tách output').item.json.alt_text }}"
            },
            {
              "name": "title",
              "value": "={{ $('Tách output').item.json.chapter_title }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3220,
        1600
      ],
      "id": "9b49d0cb-f2ee-4fb7-b0cf-6d76f8d42016",
      "name": "Update image meta data",
      "credentials": {
        "wordpressApi": {
          "id": "QgbogXv2coNRFVF3",
          "name": "hondaotosaigonquan2.com.vn"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "batchSize": "=1",
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -40,
        1580
      ],
      "id": "ea6c6cba-cfdc-4bf1-bff0-d50bf272126c",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3b788b4f-075c-4b3b-bdb6-d65848689dda",
              "name": "Keyword",
              "value": "thông số kỹ thuật Honda City",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -300,
        1400
      ],
      "id": "72b40074-6034-4c31-960d-bfdf6a49d9fb",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "=Vui lòng phân tích hình ảnh và cho tôi biết:\nImage URL: {{ $json.original }}\n\n1. Hình ảnh này có chứa bất kỳ logo thương hiệu hoặc thông tin doanh nghiệp nào không?\n2. Có bất kỳ văn bản nào hiển thị trên hình ảnh không?\n3. Chúng ta nên giữ hình ảnh này cho nội dung blog chuyên nghiệp hay xóa nó?\n\nOutput JSON:\n- **Không được sử dụng dấu đánh dấu khối mã (ví dụ: ```) hoặc bất kỳ ký tự phụ trợ nào ngoài dấu {} mở và đóng JSON.**\n{\n  \"image_url\": \"{{ $json.original }}\",\n  \"has_logo\": true/false,\n  \"detected_text\": \"...\",\n  \"recommendation\": \"keep/remove\"\n}\n",
        "imageUrls": "={{ $json.original }}",
        "simplify": "={{ true }}",
        "options": {
          "maxTokens": 100
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1640,
        1760
      ],
      "id": "8864eeef-fe5a-4c6c-8f81-12217f355156",
      "name": "OpenAI2",
      "retryOnFail": true,
      "maxTries": 2,
      "credentials": {
        "openAiApi": {
          "id": "7SlLLSEUnoJ4ouGB",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "original"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        820,
        1680
      ],
      "id": "d2e8ba5a-15e1-435c-89d3-212c767e2d42",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "fieldToSplitOut": "original",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1040,
        1680
      ],
      "id": "01d8d892-0d7a-4e9e-a8ce-4b99c99c9f4e",
      "name": "Split Out4"
    },
    {
      "parameters": {
        "jsCode": "let imageUrl = $json.original;\n\ntry {\n  // Nếu content là string, parse về object\n  const parsed = typeof $json.content === 'string' ? JSON.parse($json.content) : $json.content;\n\n  return [\n    {\n      json: {\n        image_url: imageUrl,\n        has_logo: parsed.has_logo || false,\n        detected_text: parsed.detected_text || '',\n        recommendation: parsed.recommendation || 'keep'\n      }\n    }\n  ];\n} catch (error) {\n  // Nếu lỗi parse, vẫn cho chạy tiếp, nhưng không xuất kết quả lỗi\n  return [];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1960,
        1760
      ],
      "id": "dc54af98-7356-4053-a2a3-1ecb055163e3",
      "name": "Code1",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1360,
        1680
      ],
      "id": "71d27da0-6f52-4c98-9bbd-1833da062499",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        380,
        1440
      ],
      "id": "b471bdce-0c42-4400-9bc9-de570b8be3ba",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "maxItems": 5
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        600,
        1680
      ],
      "id": "6cd4be72-0f63-4dac-8007-5feb2f165fac",
      "name": "Limit2"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        1800,
        1760
      ],
      "id": "967ea87c-3e25-4c0d-b534-a66356428279",
      "name": "Merge1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "496dafc1-c4f9-4460-8e08-03e434383024",
              "leftValue": "={{ $json.has_logo }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "219ffc0f-0e33-47fd-a045-29e7350c417a",
              "leftValue": "={{ $json.recommendation }}",
              "rightValue": "keep",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1780,
        1540
      ],
      "id": "fc83b332-7050-4640-9d10-5ee2620fe07f",
      "name": "If2"
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        2080,
        1560
      ],
      "id": "146450b1-9723-4441-b026-19be91bc884a",
      "name": "Limit3"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-03-24T08:17:46.637Z",
  "versionId": "3a7d4e45-0d14-4b75-a26d-53faeb869d7a"
}